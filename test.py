import streamlit as st
import pandas as pd
import time

# ---------------------- 피부 타입별 기본 성분 ----------------------
skin_type_recommendations = {
    "중성": ["히알루론산", "판테놀", "녹차추출물"],
    "지성": ["살리실릭애씨드", "나이아신아마이드", "징크 PCA"],
    "복합성": ["알로에베라", "비타민B5", "락틱애씨드"],
    "건성": ["세라마이드", "스쿠알란", "쉐어버터"],
    "모름": ["히알루론산", "병풀추출물", "글리세린"]
}

# ---------------------- 피부 고민 데이터베이스 ----------------------
skincare_data = {
    "여드름": {
        "추천 성분": ["살리실릭애씨드", "나이아신아마이드", "티트리 오일", "아젤라익애씨드"],
        "피해야 할 성분": ["코코넛 오일", "미네랄 오일", "라놀린"],
        "추천 제품": [
            {"단계": "클렌저", "브랜드": "라로슈포제", "제품": "에빠끌라 클렌징 젤"},
            {"단계": "토너", "브랜드": "닥터지", "제품": "레드 블레미쉬 수딩 토너"},
            {"단계": "세럼", "브랜드": "이니스프리", "제품": "비자 트러블 포커싱 세럼"},
            {"단계": "크림", "브랜드": "셀트리온스킨큐어", "제품": "그린프로폴리스 크림"}
        ]
    },
    "건조": {
        "추천 성분": ["히알루론산", "세라마이드", "글리세린", "판테놀"],
        "피해야 할 성분": ["알콜", "강한 계면활성제"],
        "추천 제품": [
            {"단계": "클렌저", "브랜드": "세타필", "제품": "젠틀 스킨 클렌저"},
            {"단계": "토너", "브랜드": "라네즈", "제품": "크림 스킨 토너"},
            {"단계": "세럼", "브랜드": "닥터지", "제품": "로얄 블랙 스네일 세럼"},
            {"단계": "크림", "브랜드": "일리윤", "제품": "세라마이드 아토 크림"}
        ]
    },
    "민감": {
        "추천 성분": ["알란토인", "병풀추출물", "카모마일", "마데카소사이드"],
        "피해야 할 성분": ["향료", "파라벤", "강한 산"],
        "추천 제품": [
            {"단계": "클렌저", "브랜드": "아벤느", "제품": "젠틀 토닝 로션"},
            {"단계": "토너", "브랜드": "닥터자르트", "제품": "시카페어 토너"},
            {"단계": "세럼", "브랜드": "에스트라", "제품": "아토베리어365 하이드로 세럼"},
            {"단계": "크림", "브랜드": "센텔리안24", "제품": "마데카 크림 액티브 포뮬라"}
        ]
    },
    "미백": {
        "추천 성분": ["비타민C", "알부틴", "트라넥사믹애씨드", "코직애씨드"],
        "피해야 할 성분": ["강한 스크럽 입자", "자극적인 산"],
        "추천 제품": [
            {"단계": "클렌저", "브랜드": "한율", "제품": "달빛유자 클렌징폼"},
            {"단계": "토너", "브랜드": "코스알엑스", "제품": "화이트헤드 파워 리퀴드"},
            {"단계": "세럼", "브랜드": "오휘", "제품": "데이쉴드 비타민 세럼"},
            {"단계": "크림", "브랜드": "숨37°", "제품": "화이트 어워드 크림"}
        ]
    },
    "주름": {
        "추천 성분": ["레티놀", "펩타이드", "아데노신", "콜라겐"],
        "피해야 할 성분": ["자극적인 산", "강한 알콜"],
        "추천 제품": [
            {"단계": "클렌저", "브랜드": "키엘", "제품": "칼렌듈라 딥 클렌징 폼"},
            {"단계": "토너", "브랜드": "아이오페", "제품": "더마 리페어 시카 토너"},
            {"단계": "세럼", "브랜드": "미샤", "제품": "타임 레볼루션 나이트 리페어 앰플"},
            {"단계": "크림", "브랜드": "AHC", "제품": "프리미엄 아이크림 포 페이스"}
        ]
    },
    "요철": {
        "추천 성분": ["AHA", "PHA", "나이아신아마이드", "레티놀"],
        "피해야 할 성분": ["두꺼운 오일", "실리콘 계열 성분"],
        "추천 제품": [
            {"단계": "클렌저", "브랜드": "닥터지", "제품": "브라이트닝 필링 젤"},
            {"단계": "토너", "브랜드": "코스알엑스", "제품": "AHA/BHA 클라리파잉 토너"},
            {"단계": "세럼", "브랜드": "더랩바이블랑두", "제품": "AHA 10% 세럼"},
            {"단계": "크림", "브랜드": "구달", "제품": "청귤 비타C 잡티 크림"}
        ]
    },
    "여드름 흉터": {
        "추천 성분": ["비타민C", "알부틴", "트라넥사믹애씨드", "마데카소사이드"],
        "피해야 할 성분": ["강한 스크럽 입자", "과도한 산"],
        "추천 제품": [
            {"단계": "클렌저", "브랜드": "한율", "제품": "달빛유자 클렌징폼"},
            {"단계": "토너", "브랜드": "아이소이", "제품": "잡티 토너"},
            {"단계": "세럼", "브랜드": "비타민트리", "제품": "VC 세럼"},
            {"단계": "크림", "브랜드": "센텔리안24", "제품": "마데카 크림"}
        ]
    }
}

# ---------------------- 앱 레이아웃 ----------------------
st.set_page_config(page_title="피부고민에 따른 성분 추천", layout="wide")

# 🎨 파스텔톤 CSS 스타일
st.markdown("""
    <style>
    body {
        background-color: #ffe6f0;
    }
    .stApp {
        background-color: #ffe6f0;
    }
    h1, h2, h3, h4 {
        color: #ff80a6;
    }
    .stButton>button {
        background-color: #ffb3c6;
        color: white;
        border-radius: 12px;
        border: none;
        padding: 0.5em 1em;
    }
    .stButton>button:hover {
        background-color: #ff99bb;
        color: white;
    }
    .stDownloadButton>button {
        background-color: #ffb3c6;
        color: white;
        border-radius: 12px;
        border: none;
        padding: 0.5em 1em;
    }
    .stDownloadButton>button:hover {
        background-color: #ff99bb;
        color: white;
    }
    .reportview-container .main .block-container{
        padding-top: 1rem;
    }
    </style>
""", unsafe_allow_html=True)

st.markdown("""
    <h1 style='text-align: center;'>💖 피부고민에 따른 성분 추천 💖</h1>
    <p style='text-align: center; font-size:18px;'>당신의 피부를 위한 맞춤 가이드를 준비했어요 ✨<br>피부 고민과 타입에 따라 알맞은 성분과 제품을 확인해보세요.</p>
""", unsafe_allow_html=True)

# ---------------------- 사이드바 선택 ----------------------
st.sidebar.header("피부 정보 선택")
skin_type = st.sidebar.selectbox("피부 타입을 골라주세요", ["중성", "지성", "복합성", "건성", "모름"])
skin_concern = st.sidebar.selectbox("피부 고민을 골라주세요", list(skincare_data.keys()))

# ---------------------- 결과 표시 ----------------------
if skin_concern:
    with st.spinner("당신의 피부에 맞는 성분과 제품을 찾는 중이에요... 🔍💕"):
        time.sleep(2)

    data = skincare_data[skin_concern]

    st.subheader("🌸 피부 타입별 추천 성분")
    st.write(f"선택하신 피부 타입({skin_type})에는 이런 성분들이 좋아요: ")
    st.success(", ".join(skin_type_recommendations[skin_type]))

    st.subheader("✨ 고민 맞춤 추천 성분")
    st.write(", ".join(data["추천 성분"]))

    st.subheader("⚠️ 주의하시면 좋아요")
    st.warning(", ".join(data["피해야 할 성분"]))

    st.subheader("🧴 추천 루틴")
    for product in data["추천 제품"]:
        st.write(f"- **{product['단계']}** 👉 {product['브랜드']} - {product['제품']}")

    st.subheader("📋 표로 보기")
    df = pd.DataFrame(data["추천 제품"])
    st.table(df)

    # CSV 저장 버튼
    csv = df.to_csv(index=False).encode("utf-8-sig")
    st.download_button(
        label="📥 추천 제품 리스트 다운로드",
        data=csv,
        file_name=f"{skin_concern}_추천제품.csv",
        mime="text/csv"
    )
